<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
  <header class="bg-slate-900/50 backdrop-blur-xl border-b border-slate-700/50 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-3 sm:py-4">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
        <div class="flex-1 flex flex-row items-center gap-3 w-full lg:w-auto">
          <div class="flex flex-row items-center gap-2">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"
              class="w-16 h-16 sm:w-20 sm:h-20 flex-shrink-0 mb-2" fill="none">
              <defs>
                <linearGradient id="droidGradient" x1="0" y1="0" x2="200" y2="200">
                  <stop offset="0%" stop-color="#3DDC84" />
                  <stop offset="100%" stop-color="#258f56" />
                </linearGradient>
                <linearGradient id="serverGradient" x1="50" y1="80" x2="150" y2="150">
                  <stop offset="0%" stop-color="#1e293b" />
                  <stop offset="100%" stop-color="#0f172a" />
                </linearGradient>
              </defs>
              <path d="M65 45 L50 25" stroke="#3DDC84" stroke-width="8" stroke-linecap="round" />
              <path d="M135 45 L150 25" stroke="#3DDC84" stroke-width="8" stroke-linecap="round" />
              <path d="M40 90 C40 45 160 45 160 90 Z" fill="url(#droidGradient)" />
              <rect x="40" y="95" width="120" height="80" rx="10" fill="url(#serverGradient)" stroke="#3DDC84"
                stroke-width="2" />
              <line x1="55" y1="115" x2="145" y2="115" stroke="#334155" stroke-width="2" />
              <line x1="55" y1="135" x2="145" y2="135" stroke="#334155" stroke-width="2" />
              <line x1="55" y1="155" x2="145" y2="155" stroke="#334155" stroke-width="2" />
              <circle cx="70" cy="70" r="5" fill="white" />
              <circle cx="130" cy="70" r="5" fill="white" />
              <circle cx="135" cy="115" r="3" fill="#3DDC84" />
              <circle cx="135" cy="135" r="3" fill="#3DDC84" />
              <circle cx="135" cy="155" r="3" fill="#ef4444" />
            </svg>
            <h1 class="text-3xl sm:text-5xl tracking-tighter leading-none font-orbitron">
              <span class="text-white font-bold">DROID</span><span class="text-[#3DDC84] font-black">VPS</span>
            </h1>
          </div>
        </div>
        <div class="flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-end">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full animate-pulse" [ngClass]="isConnected() ? 'bg-green-500' : 'bg-red-500'">
            </div>
            <span class="text-xs sm:text-sm text-slate-400">{{ isConnected() ? ('Conectado como ' +
              username.toUpperCase()) : 'Desconectado' }}</span>
          </div>
          <button (click)="handleLogout()"
            class="flex items-center gap-2 px-3 sm:px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors border border-slate-700 text-sm">
            <i class="fa-solid fa-right-from-bracket"></i>
            Cerrar Sesión
          </button>
        </div>
      </div>
      <nav class="mt-4 sm:mt-6 flex gap-1 sm:gap-2 overflow-x-auto pb-2 sm:pb-0">
        <button *ngFor="let item of navItems" (click)="selectView(item.id)"
          class="flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm"
          [ngClass]="currentView === item.id ? 'bg-blue-500 text-white shadow-lg' : 'bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-slate-300'">
          <i [class]="item.icon"></i>
          <span>{{ item.label }}</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div *ngIf="!isConnected()"
      class="mb-6 flex items-start gap-3 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
      <span class="text-yellow-400">⚠️</span>
      <div>
        <p class="text-sm text-yellow-300 font-medium">Conexión Perdida</p>
        <p class="text-xs text-yellow-400 mt-1">Intentando reconectarse al servidor...</p>
      </div>
    </div>

    <app-system-resources *ngIf="currentView === 'overview'" [data]="systemData()" [deviceInfo]="deviceInfo()"
      [batteryInfo]="batteryInfo()" [temperatureInfo]="temperatureInfo()"></app-system-resources>

    <app-process-list *ngIf="currentView === 'processes'" [data]="systemData()"></app-process-list>

    <div *ngIf="currentView === 'terminal'"
      class="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5 sm:p-6 h-[calc(100vh-200px)] flex flex-col">
      <div class="mb-4">
        <h2 class="text-xl font-bold text-white flex items-center gap-2">Terminal</h2>
        <p class="text-sm text-slate-400 mt-1">Terminal web completa para administrar tu sistema.</p>
      </div>
      <div
        class="flex-1 bg-slate-900/30 rounded-md border border-slate-700 overflow-hidden flex items-center justify-center">
        <div *ngIf="loadingTerminal" class="flex flex-col items-center justify-center">
          <i class="fa-solid fa-spinner fa-spin text-5xl text-blue-500 mb-4"></i>
          <p class="text-slate-400 text-base">Cargando terminal...</p>
        </div>
        <iframe *ngIf="!loadingTerminal && terminalUrl" [src]="safeTerminalUrl" class="w-full h-full border-none"
          title="Terminal Web" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
        <div *ngIf="!loadingTerminal && !terminalUrl" class="flex flex-col items-center justify-center">
          <p class="text-red-400 text-base">Error al cargar la terminal</p>
          <button (click)="selectView('terminal')"
            class="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-sm flex items-center gap-2">
            <i class="fa-solid fa-rotate-right"></i>
            Reintentar
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="currentView === 'proot'"
      class="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5 sm:p-6 space-y-4">
      <div>
        <h2 class="text-xl font-bold text-white">Crear nueva instancia proot</h2>
        <p class="text-sm text-slate-400 mt-1">Define un nombre y puerto para lanzar la distro.</p>
      </div>
      <form (ngSubmit)="handleCreateInstance()" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div class="flex flex-col gap-2">
          <label class="text-xs font-semibold text-slate-300">Nombre de la instancia</label>
          <input [(ngModel)]="distroName" name="distroName"
            class="w-full px-3 py-2 bg-slate-900/60 border border-slate-700 rounded-md text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            placeholder="ej: node, python, postgres" />
        </div>
        <div class="flex flex-col gap-2">
          <label class="text-xs font-semibold text-slate-300">Puerto</label>
          <input [(ngModel)]="distroPort" name="distroPort"
            class="w-full px-3 py-2 bg-slate-900/60 border border-slate-700 rounded-md text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            placeholder="8022" inputmode="numeric" />
        </div>
        <div class="flex gap-2 md:justify-end">
          <button type="submit" [disabled]="isCreating"
            class="flex-1 md:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white font-semibold rounded-md transition disabled:opacity-60 disabled:cursor-not-allowed">
            <ng-container *ngIf="isCreating; else createLabel">
              <i class="fa-solid fa-spinner fa-spin"></i>
              <span>Creando...</span>
            </ng-container>
            <ng-template #createLabel>
              <i class="fa-solid fa-plus"></i>
              Crear instancia
            </ng-template>
          </button>
          <button type="button" (click)="distroName=''; distroPort='8022'; createError=null; createSuccess=null"
            class="flex-1 md:flex-none px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold rounded-md transition flex items-center justify-center gap-2">
            <i class="fa-solid fa-broom"></i>
            Limpiar
          </button>
        </div>
      </form>
      <div *ngIf="createSuccess"
        class="flex items-start gap-2 p-3 rounded-md border border-emerald-500/40 bg-emerald-500/10 text-emerald-200 text-sm">
        <span class="font-semibold">Éxito:</span> {{ createSuccess }}
      </div>
      <div *ngIf="createError"
        class="flex items-start gap-2 p-3 rounded-md border border-red-500/40 bg-red-500/10 text-red-200 text-sm">
        <span class="font-semibold">Error:</span> {{ createError }}
      </div>
      <app-proot-list [serverUrl]="serverUrl" [token]="token"></app-proot-list>
    </div>
  </main>
</div>